# Ecomana website

## Changes

Connection with github version 2
.env variables included on CodeBuild
Change the bucket name to match the website domain

## Deployment

Here's a **summary of the entire process** we went through to set up AWS CodePipeline for deploying your Astro website to an S3 bucket. You can use this summary to update your `README.md` file:

---

## AWS CodePipeline Setup for Astro Website Deployment

This project utilizes AWS CodePipeline to automate the deployment of an Astro website to an S3 bucket. The pipeline is triggered whenever new changes are pushed to the `main` branch of the GitHub repository, and it automatically builds the project using AWS CodeBuild and deploys the static files to an Amazon S3 bucket.

## Steps to Set Up the Pipeline

### 1. **Create the Pipeline**

1. **Pipeline Settings**:
   - Pipeline Name: `ecomana-deployment`
   - Pipeline Type: V2 (default)
   - Execution Mode: **SUPERSEDED** (allows newer pipeline runs to overtake older ones)
   - Service Role: **AWSCodePipelineServiceRole-us-east-1-ecomana-deployment**

2. **Source Stage**:
   - Source Provider: **GitHub (Version 2)**
   - Repository: `ecomana-website`
   - Branch: `main`
   - Output Artifact: `SourceArtifact`
   - Trigger: Automatically triggers on any push to the `main` branch.

3. **Build Stage**:
   - Build Provider: **AWS CodeBuild**
   - Project Name: `EcomanaWebsiteBuild`
   - Input Artifact: `SourceArtifact`
   - Output Artifact: `BuildArtifact`
   - **Buildspec.yml**: Make sure your project contains a `buildspec.yml` file that defines the build process.

   Example `buildspec.yml` file:

```yaml
   version: 0.2

   phases:
     install:
       commands:
         - npm install
     build:
       commands:
         - npm run build
   artifacts:
     files:
       - '**/*'
     base-directory: dist
```

4. **Deploy Stage**:
   - Deploy Provider: **Amazon S3**
   - S3 Bucket: `ecomana-painting-co`
   - Input Artifact: `BuildArtifact`
   - Extract Files Before Deploying: Enabled
   - Automatic Rollback on Failure: Enabled (optional)

### 2. **Create IAM Roles**

Ensure the necessary IAM roles are created and have the correct permissions:

- **AWSCodePipelineFullAccess**
- **AWSCodeBuildAdminAccess**
- **AmazonS3FullAccess**

These roles are required for CodePipeline to access GitHub, build the project, and deploy files to S3.

### 3. **Final Review and Pipeline Creation**

After setting up the stages, review the configuration and click **Create Pipeline**. The pipeline will now automatically build and deploy the website whenever new changes are pushed to the `main` branch on GitHub.

## How the Pipeline Works

1. **Source Stage**: Pulls the latest code from the `main` branch of the GitHub repository.
2. **Build Stage**: Builds the website using `npm install` and `npm run build` via AWS CodeBuild.
3. **Deploy Stage**: Deploys the static files generated by the build process to the specified S3 bucket (`ecomana-painting-co`), making the website live.
